name: pr-guard-main

on:
  pull_request_target:
    branches: [main]
    types: [opened, reopened, synchronize]

permissions:
  contents: read
  pull-requests: read

jobs:
  validate:
    if: github.event.pull_request.base.ref == 'main'
    runs-on: ubuntu-latest

    steps:
      - name: Validate source branch
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const head = pr?.head?.ref || "";
            const ok = /^hotfix\//.test(head) || /^release\//.test(head) || /^release-please--/.test(head);

            if (!ok) {
              core.setFailed(
                `PR to main must come from hotfix/*, release/* or release-please--*. Got: ${head}`
              );
            } else {
              core.notice(`Valid source branch: ${head}`);
            }